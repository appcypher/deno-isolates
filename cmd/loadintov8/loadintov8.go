package main

import (
	"fmt"

	"rogchap.com/v8go"
)

var bytes = []uint8{
	0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00, 0x01, 0x07, 0x01,
	0x60, 0x02, 0x7f, 0x7f, 0x01, 0x7f, 0x03, 0x02, 0x01, 0x00, 0x07,
	0x07, 0x01, 0x03, 0x61, 0x64, 0x64, 0x00, 0x00, 0x0a, 0x09, 0x01,
	0x07, 0x00, 0x20, 0x00, 0x20, 0x01, 0x6a, 0x0b,
}

const code = `
const module = new WebAssembly.Module(bytes)
const instance = new WebAssembly.Instance(module)

instance.exports.add(3, 4)
`

func main() {
	iso, _ := v8go.NewIsolate()
	ctx, _ := v8go.NewContext(iso)

	global := ctx.Global()
	global.Set("bytes", bytes)

	val, err := ctx.RunScript(code, "result.js")
	if err != nil {
		fmt.Println(err)
		return
	}

	fmt.Printf("result: %s\n", val)
}
